This directory functions as the server-side coordination point for client-side file uploads to Vercel Blob storage. It implements a secure, authenticated bridge that validates user sessions before granting the necessary permissions for direct-to-cloud storage operations.

### Architecture

The directory follows the Next.js App Router API pattern, specifically implementing the "Client-side upload" flow provided by the Vercel Blob SDK. Instead of proxying the file binary through the application server, this route acts as a token issuer and lifecycle manager. The architecture ensures that binary data bypasses the server while maintaining strict control over who can upload and what types of files are permitted.

### Key File Roles

- **`route.ts`**: The primary controller for the upload process. It exports a `POST` handler wrapped in observability middleware. Its responsibilities include:
  - **Authentication**: Verifying the requestor's identity via Clerk.
  - **Token Generation (`onBeforeGenerateToken`)**: Defining the security perimeter for the upload, including a 5MB size limit and a whitelist of allowed MIME types (`image/jpeg`, `image/png`, `image/webp`). It also injects the `userId` into the token payload for metadata tracking.
  - **Lifecycle Hook (`onUploadCompleted`)**: Executing server-side logic (logging) once the provider confirms the file has been successfully persisted.
  - **Error Handling**: Integrating with Sentry to capture failures while returning sanitized error responses to the client.

### Dependencies and Gotchas

- **Dependencies**: The implementation relies on `@vercel/blob` for the storage protocol, `@clerk/nextjs` for identity, and internal library wrappers (`@/lib/api/withObservability` and `@/lib/sentry`) for telemetry.
- **Constraints**: Uploads are restricted to specific image formats; attempts to upload other file types or files exceeding 5,242,880 bytes will be rejected during the token generation phase.
- **Security**: The `addRandomSuffix: true` configuration is enabled to prevent filename collisions and overwriting existing blobs in the storage bucket.
- **Payload Handling**: The route expects a JSON body conforming to the `HandleUploadBody` type; malformed requests are rejected with a 400 Bad Request status.
