This directory implements a secure, authenticated proxy for audio streaming within the listening sessions module. Its primary purpose is to act as a protected intermediary between the client and external blob storage, ensuring that audio files are only accessible to authorized session owners while supporting native browser playback features like seeking.

### Architecture

The directory follows the Next.js App Router API pattern, utilizing a request-response lifecycle that integrates identity management, database authorization, and network proxying. The architecture is designed around a "zero-trust" flow: it verifies the user's identity via Clerk, retrieves a scoped access token for the database, validates the requested resource's ownership in Convex, and performs a server-side fetch to the storage provider. To support efficient audio playback, the proxy implements transparent header forwarding for HTTP Range requests.

### Key File Roles

- **`route.ts`**: The entry point for the audio proxy. It handles `GET` requests by:
  - **Identity Verification**: Validating the Clerk session and retrieving a Convex-compatible JWT.
  - **Authorization**: Querying the `listeningSessions` database to verify the user owns the session and to retrieve the underlying storage URL.
  - **Security Filtering**: Validating the retrieved URL against a trusted host policy to prevent SSRF (Server-Side Request Forgery) or unauthorized data egress.
  - **Stream Proxying**: Forwarding the client's `Range` headers to the upstream storage, then piping the resulting binary stream back to the client with appropriate `Content-Type` and `Cache-Control` headers.
  - **Observability**: Wrapping the execution logic in a telemetry layer for logging and error reporting via Sentry.

### Important Dependencies

- **Clerk (`@clerk/nextjs/server`)**: Provides the authentication context and JWT templates required for secure service-to-service communication.
- **Convex (`convex/browser`)**: Used via the `ConvexHttpClient` to perform authenticated, server-side database lookups.
- **Observability Libs**: Custom wrappers (`withObservability`, `log`) and Sentry (`captureError`) for monitoring the health of the proxy.
- **Trusted Host Utility**: A local dependency (`isTrustedAudioHost`) that enforces domain-level security for audio sources.

### Gotchas

- **Range Request Handling**: The proxy must manually forward `Range` and `Content-Range` headers. If these are stripped or handled incorrectly, browser audio players will be unable to seek (scrub) through the audio files.
- **Status Code Mapping**: The route explicitly handles `206 Partial Content` and `416 Range Not Satisfiable` status codes. These must be preserved from the upstream provider to ensure the browser's media engine can manage buffer states correctly.
- **Environment Configuration**: The logic is strictly dependent on `NEXT_PUBLIC_CONVEX_URL`. If this environment variable is missing or incorrectly formatted, the route returns a `503 Service Unavailable`.
- **Binary Stream Integrity**: The implementation uses the web-standard `ReadableStream` (via `blobResponse.body`) to pipe data, avoiding loading entire audio files into server memory and reducing latency for large files.
