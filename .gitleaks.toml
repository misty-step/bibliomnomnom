# Gitleaks Configuration for bibliomnomnom
# Docs: https://github.com/gitleaks/gitleaks

title = "Gitleaks config for Next.js + Convex + Clerk"

# Extend default ruleset
[extend]
useDefault = true

# Custom rules for this project
[[rules]]
id = "next-public-secret"
description = "NEXT_PUBLIC_ prefixed secrets should not contain sensitive tokens"
regex = '''NEXT_PUBLIC_[A-Z_]*(?:SECRET|KEY|TOKEN|PASSWORD)'''
path = '''\.(ts|tsx|js|jsx|env)$'''

[[rules]]
id = "convex-deploy-key"
description = "Convex deployment keys must not be committed"
regex = '''(?i)(convex[_-]?deploy[_-]?key)["\s:=]+([a-z0-9]{32,})'''
secretGroup = 2

[[rules]]
id = "clerk-secret"
description = "Clerk secret keys must not be committed"
regex = '''(?i)(clerk[_-]?secret[_-]?key)["\s:=]+(sk_[a-z0-9]{32,})'''
secretGroup = 2

[[rules]]
id = "vercel-token"
description = "Vercel tokens must not be committed"
regex = '''(?i)(vercel[_-]?token)["\s:=]+([a-z0-9]{24,})'''
secretGroup = 2

[[rules]]
id = "blob-token"
description = "Vercel Blob tokens must not be committed"
regex = '''(?i)(blob[_-]?read[_-]?write[_-]?token)["\s:=]+(vercel_blob_rw_[a-z0-9]{32,})'''
secretGroup = 2

# Allowlist patterns for test fixtures and documentation
[allowlist]
description = "Allowlist for test fixtures, examples, and build artifacts"
paths = [
  '''\.example$''',
  '''\.md$''',
  '''__tests__/fixtures/.*''',
  '''\.test\.(ts|tsx|js|jsx)$''',
  '''\.spec\.(ts|tsx|js|jsx)$''',
  '''\.next/.*''',                          # Build cache
  '''node_modules/.*''',                    # Dependencies
  '''convex/_generated/.*''',              # Generated files
]

# Allowlist specific patterns that are safe
regexes = [
  '''NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY''',  # Public by design
  '''NEXT_PUBLIC_CONVEX_URL''',             # Public by design
  '''example\.com''',
  '''YOUR_[A-Z_]+_HERE''',
  '''xxx-xxx-xxx''',
  '''sk_test_[a-z0-9]+''',                  # Test keys
  '''pk_test_[a-z0-9]+''',                  # Test public keys
]

# Global stopwords to reduce false positives
stopwords = [
  "example",
  "sample",
  "test",
  "fake",
  "dummy",
  "placeholder",
  "TODO",
  "FIXME",
]
