The `bibliomnomnom` directory is the root of a privacy-first book tracking platform and digital garden. The application is built on a "Convex-First with Actions" architecture, utilizing **Next.js 16 (App Router)** and **React 19** for the frontend, with **Convex** providing a reactive, serverless backend. The project emphasizes radical design simplicity through a monochrome Art Deco aesthetic and maintains high quality gates via automated validation scripts and strict TypeScript enforcement.

### Architecture and Core Modules

The system is organized into deep, functional modules that isolate external side effects from core business logic:

*   **Data Layer (`/convex`)**: Acts as the single source of truth. It uses transactional Mutations for atomic writes, reactive Queries for real-time UI updates, and Actions for non-deterministic operations like AI synthesis or external API calls.
*   **Routing and API (`/app`)**: Implements the Next.js App Router. It manages authenticated dashboard routes, public reader profiles, and API orchestration for high-compute tasks like OCR, secure media streaming via **Vercel Blob**, and **Stripe** webhook processing.
*   **Frontend Architecture (`/components`, `/hooks`)**: Follows a container-presentational pattern. Complex state machines for audio capture and bulk data ingestion are encapsulated in custom hooks (e.g., `useImportJob.ts`), while UI primitives are built on **Radix UI** and **Tailwind CSS**.
*   **Logic and Utilities (`/lib`)**: Centralizes cross-cutting concerns. Key utilities include a recursive PII-scrubbing engine for **Sentry**, Stripe subscription lifecycle mapping, and a design token system generated from `design-tokens.json`.
*   **Quality and DevOps (`/__tests__`, `/e2e`, `/scripts`)**: Implements a multi-layered testing strategy using **Vitest** for unit/integration tests and **Playwright** for E2E validation. Scripts manage environment synchronization, design token compilation, and STT (Speech-to-Text) benchmarking.

### Key File Roles

*   **`ARCHITECTURE.md` & `CLAUDE.md`**: Define the foundational design principles, module boundaries, and operational invariants (e.g., all mutations must validate ownership).
*   **`schema.ts` (in `/convex`)**: The authoritative definition of the relational document store, including tables for books, listening sessions, and reader profiles.
*   **`vercel.json`**: Orchestrates the deployment pipeline, ensuring Convex functions are deployed and types are generated before the Next.js build begins.
*   **`design-tokens.json`**: The single source of truth for the application's visual variables, processed by `scripts/build-tokens.mjs` into CSS and TypeScript constants.
*   **`middleware.ts`**: Enforces global authentication gating via **Clerk**, while managing public access for specific routes like pricing and public profiles.

### Primary Dependencies

*   **Identity & Auth**: `@clerk/nextjs` for user management and session handling.
*   **Backend & DB**: `convex` for real-time persistence and serverless execution.
*   **Payments**: `stripe` for subscription management and trial lifecycle logic.
*   **AI Orchestration**: **OpenRouter** for LLM-driven book metadata extraction, OCR, and reading insight synthesis.
*   **Observability**: `@sentry/nextjs` for error tracking and `posthog-js` for product analytics.

### Technical Gotchas and Constraints

*   **Package Manager Enforcement**: The project strictly requires **Bun** (>=1.2.17). Attempts to use npm, pnpm, or yarn are blocked via preinstall hooks.
*   **Build Sequencing**: Next.js builds depend on types generated by Convex. The build command must always be `bunx convex deploy && next build` to prevent type-safety failures.
*   **JWT Configuration**: Convex authentication requires a specific JWT template named exactly `convex` within the Clerk dashboard; otherwise, token retrieval will return 404 errors.
*   **Environment Parity**: Certain secrets, specifically `OPENROUTER_API_KEY` and `CONVEX_WEBHOOK_TOKEN`, must be synchronized across both Vercel and Convex environment variables to maintain functional AI integrations and webhook security.
*   **Deterministic Mutations**: All logic within Convex Mutations and Queries must be deterministic; any network egress or non-deterministic logic must be isolated within Actions.
*   **Async Route Params**: In alignment with Next.js 15+ patterns, dynamic route parameters (e.g., `[username]`) are treated as Promises and must be explicitly awaited.