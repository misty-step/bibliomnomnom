The `/docs/postmortems` directory serves as a centralized repository for incident reports and retrospective analyses of critical system failures within the Bibliomnomnom application. The directory is structured chronologically, utilizing Markdown files to document service interruptions, data inconsistencies, and integration failures. Its primary purpose is to provide a blameless historical record that captures root cause analyses (RCA), impact metrics, and technical debt surfacing from production issues.

### Architecture and Structure

The documents within this directory follow a standardized postmortem template that includes:

- **Metadata**: Severity levels (e.g., P1), duration of impact, and authorship.
- **Timeline**: A chronological sequence of events from deployment and discovery to resolution.
- **Root Cause Analysis**: A "5 Whys" investigation into the underlying technical or procedural failures.
- **Action Items**: Tracking of immediate fixes and long-term preventative measures.

### Key File Roles

- **`2026-01-17-stripe-webhook-failure.md`**: This file documents a critical failure in the billing pipeline where subscription data failed to sync between Stripe and the Convex backend. It details the specific failure points across the distributed architecture, including URL mismatches between the production domain and Stripe's webhook configuration, and the failure of the Convex backend to validate incoming requests due to missing environment variables.

### Dependencies and Technical Gotchas

- **Cross-Platform Environment Synchronization**: The system relies on synchronized environment variables across Vercel (frontend/edge functions) and Convex (backend actions). A recurring "gotcha" identified is the presence of trailing newlines (`\n`) in secrets, which can cause cryptic "Invalid character in header" errors or validation mismatches during webhook authentication.
- **Convex CLI Environment Context**: There is a documented dependency on the `npx convex` CLI for data inspection. A significant technical pitfall involves the ambiguity of the `CONVEX_DEPLOYMENT` environment variable versus explicit flags; using the CLI without the `--prod` flag can lead to developers inadvertently querying development data while investigating production incidents.
- **Webhook Integrity**: The architecture depends on a three-way handshake between Stripe, Vercel, and Convex. The `CONVEX_WEBHOOK_TOKEN` is a critical dependency for securing these transactions; if this token is missing from the Convex production environment or malformed on the Vercel side, the state synchronization between the payment processor and the database fails silently.
- **Deployment Checklist Sensitivity**: The system is sensitive to domain configuration; the transition from development to production requires manual updates to Stripe's webhook endpoints to match the production URL (e.g., shifting from `.app` to `.com` domains).
