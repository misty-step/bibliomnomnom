This directory serves as the automation and DevOps hub for the bibliomnomnom project, providing a polyglot suite of tools for environment synchronization, quality assurance, build-time asset generation, and operational observability. The architecture relies on a mix of Bash for system-level orchestration, TypeScript (via Bun) for internal logic, and Python for specialized benchmarking.

### Core Architecture and Key File Roles

**1. Environment Management and Synchronization**

- **`validate-env.sh`**: A comprehensive validator that checks local, development, and production environments. It enforces strict formatting rules (e.g., hex length, Stripe key prefixes) and detects trailing whitespace or newlines that frequently cause runtime failures.
- **`ensure-convex-webhook-token.sh` and `convex-env-sync.sh`**: These scripts manage the reconciliation of secrets between local `.env.local` files and the Convex backend. They ensure that `CONVEX_WEBHOOK_TOKEN` and OpenRouter API keys are synchronized to maintain functional webhook and AI integration.
- **`dev-stripe.sh`**: Orchestrates local Stripe development by automating webhook forwarding and dynamically updating ephemeral secrets in the local environment.

**2. Build and Development Tooling**

- **`build-tokens.mjs`**: A design-system compiler that transforms `design-tokens.json` into CSS variables and TypeScript constants. It handles theme-switching logic by generating specific `.dark` class overrides.
- **`bun.sh`**: A runtime wrapper that ensures consistent execution of Bun commands, optionally leveraging `asdf` for version management based on `.tool-versions`.
- **`generate-releases.ts`**: An AI-augmented utility that parses `CHANGELOG.md` and uses OpenRouter (DeepSeek V3.2) to synthesize technical changes into user-facing product notes, outputting structured JSON and Markdown.

**3. Quality Assurance and Benchmarking**

- **`session-guardrails.ts`**: A smoke-testing suite for the "listening session" state machine. It mocks the Convex database context to validate state transitions, cost estimation logic, and data normalization without requiring a live backend.
- **`verify-deploy-ready.sh`**: The primary CI/CD gatekeeper. It aggregates environment validation, git status checks, TypeScript type-checking, test execution, and secret scanning.
- **`stt-eval.py`**: A Python-based benchmarking tool for Speech-to-Text providers (ElevenLabs, Deepgram, AssemblyAI). it measures latency, cost-per-minute, and accuracy via consensus similarity.

**4. Operations and Distribution**

- **`obs`**: A custom observability CLI that wraps Sentry and Vercel APIs. It provides commands for triaging issues, checking deployment health, and monitoring listening session error rates.
- **`setup-distribution.sh` and `check-readiness.sh`**: Onboarding and health-check tools designed to guide new deployments through account creation and configuration verification.

### Important Dependencies and Gotchas

- **Cross-Platform Parity**: A critical requirement enforced by `verify-deploy-ready.sh` is the exact match of `CONVEX_WEBHOOK_TOKEN` across Vercel and Convex; mismatches result in silent webhook failures.
- **External Tooling**: Several scripts depend on globally installed CLIs, including `stripe`, `vercel`, and `trufflehog`. The `stt-eval.py` script specifically requires `ffmpeg` and `ffprobe` for audio processing.
- **API Requirements**: `generate-releases.ts` requires an active `OPENROUTER_API_KEY`. If the key is missing, the script defaults to a "changelog-only" mode or fails in CI environments.
- **Environment Formatting**: The validation logic identifies trailing newlines in `.env` files (often introduced by `echo >>`) as a high-risk factor for authentication failures with Stripe and Clerk.
- **STT Limitations**: `stt-eval.py` intentionally excludes AssemblyAI's Universal-Streaming API due to session duration constraints, favoring the async batch API (Universal-2) instead.
