The `lib/security` directory provides essential security utilities for the application, specifically focusing on defense-in-depth mechanisms for Convex actions and webhook handlers. Its primary role is to ensure that inbound requests are authenticated using secure, timing-attack-resistant validation techniques.

### Architecture and Key File Roles

The directory follows a utility-based pattern, centralizing security logic to ensure consistency across different service integrations.

- **`webhookToken.ts`**: This file contains the core logic for validating pre-shared tokens. It implements a constant-time comparison algorithm, `timingSafeCompare`, which uses bitwise XOR operations to prevent side-channel timing attacks that could otherwise leak information about the expected token. The primary interface, `validateWebhookToken`, compares an incoming request token against a server-side secret (defaulting to the `CONVEX_WEBHOOK_TOKEN` environment variable).

### Security Implementation and Gotchas

- **Timing Attack Mitigation**: The implementation avoids standard string comparison operators, which return early upon finding a mismatch. Instead, it iterates through all characters to ensure the execution time remains independent of the input's correctness.
- **Information Disclosure Prevention**: All validation failures throw a generic "Webhook authentication failed" error. This prevents external actors from probing the system to determine if a specific environment variable is missing or if the provided token was partially correct.
- **Configuration Safeguards**: The validation logic explicitly rejects empty strings for both the provided and expected tokens. This prevents authentication bypasses in scenarios where environment variables might be misconfigured or left as empty strings in certain environments.
- **Dependencies**: The module is designed to function within the Convex runtime, relying on `process.env` for secret retrieval. It is intended to be used as a secondary layer of security alongside provider-specific signature verification (such as Stripeâ€™s HMAC signatures).
