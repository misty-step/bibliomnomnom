This directory contains the navigation and identity components for the `bibliomnomnom` application. The architecture follows a modular, client-side pattern designed to integrate with the Next.js App Router, providing global navigation, user identity management, and contextual data visualization.

### Key File Roles

- **`LibraryNav.tsx`**: A polymorphic navigation component supporting "rail" (sidebar) and "bar" (horizontal) layouts. It manages its own collapsed state with persistence and implements custom keyboard accessibility for arrow-key navigation.
- **`Masthead.tsx`**: The primary application header. It provides top-level routing to user profiles and settings while housing the brand identity and the Clerk `UserButton`.
- **`TopNav.tsx`**: A secondary global navigation bar focused on the core "Library" route, sharing common identity elements like the `ThemeToggle`.
- **`StatsBar.tsx`**: A data-driven utility component that fetches book metadata from the Convex backend to display real-time reading statistics (total, read, reading, and favorites) with built-in skeleton loading states.

### Architecture and Logic

The directory utilizes a "use client" strategy to access browser APIs and navigation hooks. Routing logic is centralized around the `usePathname` hook from `next/navigation`, which determines active link states through exact matches or prefix-based sub-route detection. Component styling relies on a utility-first approach via `tailwind-merge` and `clsx`, often abstracting complex layout transitions through internal design tokens and the `Surface` UI primitive.

### Dependencies and Integration

- **Next.js Navigation**: Deeply integrated for path detection and client-side routing.
- **Clerk**: Handles user session visibility and account actions via the `UserButton` component.
- **Convex**: Powers the `StatsBar` through the `useAuthedQuery` hook, facilitating reactive data fetching from the database.
- **Lucide React**: Provides the iconography suite for navigation links and UI actions.
- **Vitest & React Testing Library**: (Referenced in subdirectory) Used to validate DOM attributes, specifically `aria-current` and `aria-pressed`, and to simulate `localStorage` interactions.

### Technical Gotchas

- **Storage Persistence**: `LibraryNav` uses a custom `useCollapsePreference` hook that interacts with `window.localStorage`. This requires safeguards against Server-Side Rendering (SSR) environments where `window` is undefined.
- **Media Query Defaults**: The `LibraryNav` rail layout automatically collapses on screens narrower than 768px via `window.matchMedia`, which may conflict with purely CSS-based responsive logic if not accounted for during hydration.
- **Keyboard Management**: Focus management for `LibraryNav` is handled manually via a `useRef` array of `HTMLAnchorElement` objects to support circular arrow-key navigation, bypassing standard tab-order behavior for specific UX patterns.
- **Conditional Logic**: The "Collapse" functionality and its associated `localStorage` key (`library-nav-collapsed`) are conditionally rendered and processed based on the `layout` prop, meaning the bar configuration ignores persistence logic.
