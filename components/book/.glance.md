### Purpose and Architecture

The `components/book` directory serves as the core module for managing book-related entities within the application. Its primary purpose is to provide a comprehensive interface for browsing, searching, and maintaining a personal library. The architecture follows a modular, state-driven React pattern integrated with **Convex** for real-time data persistence and **Vercel Blob** for binary asset storage.

The module is characterized by a "Editorial/Art Deco" design aesthetic, utilizing **Framer Motion** for layout transitions and **Lucide React** for iconography. It implements a clear separation between data entry (forms), data visualization (grids/tiles), and asset management (cover sourcing).

### Key File Roles

- **`BookGrid.tsx` & `LibraryView.tsx`**: The primary entry point for the library. It handles complex client-side filtering (e.g., "Currently Reading", "Favorites") and implements a chronological "Timeline" view for finished books, grouping items by year and month.
- **`BookDetail.tsx`**: A comprehensive view for individual books. It manages high-level state transitions (status updates, privacy toggles, favorite marking) and integrates with the notes system.
- **`BookTile.tsx`**: The foundational UI component for the grid. It features an "index card" hover state and handles event-stopped status mutations (e.g., "Start Reading") directly from the card.
- **`BookCoverManager.tsx` & `CoverPicker.tsx`**: These files manage the lifecycle of book covers. They support a multi-channel sourcing strategy: manual file uploads to Vercel Blob, "I'm Feeling Lucky" auto-fetching, and a manual web search interface via Open Library and Google Books APIs.
- **`BookForm.tsx` & `AddBookSheet.tsx`**: Handle the creation and editing of book metadata. `BookForm.tsx` includes specialized sanitization logic (`sanitizeBookForm`) to handle numeric parsing for page counts and date-to-timestamp conversions.
- **`BookSearchInput.tsx` & `BookSearchResultItem.tsx`**: Implement a debounced, accessible combobox for querying external book databases to pre-populate form data.
- **`YearHero.tsx` & `StatusBadge.tsx`**: Presentational components that reinforce the visual identity of the library, specifically for chronological section headers and status labeling.
- **`constants.ts`**: Centralizes the `BookStatus` type definitions and configuration options used across the module.

### Important Dependencies

- **Convex (`convex/react`)**: Used for all server-side state, including queries for library listing and mutations for book updates.
- **Vercel Blob (`@vercel/blob`)**: Facilitates client-side uploads for custom cover images.
- **Framer Motion**: Powers the layout animations, specifically the `layout` prop in badges and spring-based transitions in the `BookTile`.
- **Next.js Image**: Handles cover rendering, though often used with the `unoptimized` prop for external API URLs that are not pre-configured in `next.config.js`.

### Technical Gotchas

- **Image Optimization**: Many book covers are sourced from external domains (Google Books, Open Library). The `BookTile` includes logic to determine if a URL is "optimizable" based on a whitelist; otherwise, it falls back to standard `<img>` tags to avoid Next.js configuration errors.
- **CORS Handling**: `BookCoverManager` utilizes a server-side action (`downloadImage`) to bypass CORS restrictions when saving external covers to the application's own storage.
- **Date Handling**: The module converts between HTML date strings (`YYYY-MM-DD`) and Unix timestamps. `BookForm` specifically creates dates at local noon to mitigate timezone shifting issues during serialization.
- **Environment Variables**: The `FetchMissingCoversButton` and backfill logic are gated by `NEXT_PUBLIC_COVER_BACKFILL_ENABLED`, which must be explicitly managed to control background API usage.
- **Event Propagation**: `BookTile` and `BookSearchInput` require strict `stopPropagation` on interactive sub-elements (like "Start Reading" buttons) to prevent triggering parent navigation handlers.
