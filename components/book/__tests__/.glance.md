The `components/book/__tests__` directory contains the unit and integration test suite for book-related UI components, utilizing **Vitest** as the test runner and **React Testing Library** for DOM assertions. The architecture focuses on verifying component behavior, state-driven rendering, and data sanitization logic.

### Key File Roles

- **`BookTile.test.tsx`**: Validates the interactive behavior of individual book cards. It ensures that action buttons (e.g., "Start Reading", "Mark as Read") render conditionally based on the book's status and that clicking these buttons triggers the appropriate backend mutations via Convex. It specifically tests event propagation to ensure that interactions with action buttons do not inadvertently trigger the parent container's navigation logic.
- **`BookForm.test.tsx`**: Focuses on the data entry and validation lifecycle. It tests the `sanitizeBookForm` utility in isolation to verify string trimming and numeric parsing. Within the component tests, it ensures that required field validations are enforced, the submit button respects "dirty" state requirements, and the final payload is correctly formatted before being passed to the submission handler.

### Architecture and Dependencies

- **Mocking Strategy**: The suite heavily employs `vi.mock` to isolate components from external side effects. Key mocks include:
  - `next/navigation`: Simulates the `useRouter` hook for verifying navigation calls.
  - `convex/react`: Mocks `useMutation` to intercept and assert on database update attempts.
  - `@/hooks/use-toast`: Mocks the toast notification system to verify success and error feedback.
  - `framer-motion`: Overrides motion components with standard HTML elements to simplify the DOM structure and avoid animation-related timing issues during tests.
- **Data Fixtures**: Tests leverage a centralized fixture utility (`@/lib/__tests__/fixtures`) to generate consistent mock book objects and IDs, ensuring type safety and reducing boilerplate.

### Important Gotchas

- **Framer Motion**: Because the components use `framer-motion` for layout animations, the tests explicitly mock `motion.article` and `useReducedMotion`. Failure to mock these can lead to unexpected behavior in a JSDOM environment where layout engine properties are not fully supported.
- **Event Bubbling**: The `BookTile` tests include specific assertions for `stopPropagation`. This is critical because the tile acts as a link, and child button clicks must be prevented from bubbling up to the card's primary click handler.
- **Asynchronous Handling**: Mutation tests use `vi.waitFor` and `user-event`'s async APIs to handle the transition between UI interactions and the resolution of mocked promises (e.g., network failures triggering destructive toasts).
