The `/components/library` directory contains client-side UI components dedicated to the management and portability of user book collections. The architecture leverages a modular React pattern integrated with the Convex real-time backend and a suite of local utility libraries for data transformation and file system interaction.

### Key File Roles

- **`ExportButton.tsx`**: A specialized client component that facilitates data extraction. It provides a dropdown interface for users to download their entire library in JSON, CSV (optimized for Goodreads compatibility), or Markdown formats. It acts as an orchestrator between the backend data layer and the client-side file generation logic.

### Architecture and Logic

The directory follows a performance-oriented approach to data handling:

- **Lazy Data Fetching**: To minimize unnecessary network overhead and memory usage, the component utilizes a conditional Convex query. Data is only requested from the `api.books.exportAllData` endpoint when the user interacts with the export menu (`isMenuOpen`), rather than on initial page load.
- **Client-Side Transformation**: The component relies on external utility functions (`toJSON`, `toCSV`, `toMarkdown`) to handle the heavy lifting of data formatting on the client side before triggering a browser-level download via a `downloadFile` helper.
- **State-Driven UI**: The component manages complex asynchronous states, including loading indicators for both data fetching and the export process, while providing feedback through a toast notification system.

### Dependencies and Technical Constraints

- **Convex**: Required for reactive data fetching and server-side API communication.
- **Lucide React**: Used for iconography (`Download`, `Loader2`).
- **Radix UI / Shadcn UI**: The component depends on a standardized UI kit for the `DropdownMenu` and `Button` primitives.
- **Data Consistency Gotcha**: The `exportedAt` timestamp is generated at the moment of the export trigger rather than the query evaluation time to ensure the file metadata reflects the actual download event.
- **Network Latency**: Because of the lazy-loading strategy, the export button remains in a disabled state briefly after the menu opens while the backend query resolves.
