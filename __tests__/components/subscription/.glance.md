This directory serves as the test suite for subscription-related UI components within the application. Its primary purpose is to validate the conditional rendering logic, user messaging, and interactive states of components that communicate subscription status, trial remaining time, and access restrictions to the user.

### Architecture and Key File Roles

The testing architecture utilizes a behavioral approach, mocking data-fetching layers and routing dependencies to isolate component logic.

- **TrialBanner.test.tsx**: This is the central test file for the `TrialBanner` component. It employs a state-driven testing strategy to verify how the UI reacts to various backend responses. The tests are organized by the user's subscription lifecycle:
  - **Loading and Active States**: Ensures the banner remains hidden when data is pending or when a user has a valid, active subscription.
  - **Trialing States**: Validates the display of "days remaining" with correct pluralization. It distinguishes between "standard" trialing (dismissible) and "urgent" trialing (3 days or fewer remaining), where the dismiss button is programmatically removed to ensure visibility.
  - **Expiration States**: Verifies that both trial and subscription expirations result in non-dismissible, high-priority alerts that direct users to the pricing page to regain access.
  - **Interaction Logic**: Confirms that the local state correctly handles user dismissal for non-critical notifications.

### Key Dependencies

- **Vitest**: The primary test runner and mocking framework.
- **@testing-library/react**: Used for rendering components and asserting against the DOM structure.
- **Convex (convex/react)**: The data layer; `useQuery` is heavily mocked to simulate different subscription payloads (`hasAccess`, `status`, `daysRemaining`, `reason`).
- **Next.js (next/link)**: The routing layer; mocked to provide a functional anchor tag replacement for the `Link` component without requiring a full Router context.

### Important Gotchas

- **Mock Resetting**: The test suite relies on `vi.fn()` for `useQuery`. It requires explicit `beforeEach` resets to prevent state leakage between different subscription scenario tests.
- **Urgency Logic**: The component's business logic dictates that the "dismiss" functionality is conditionally rendered based on the `daysRemaining` count and the `hasAccess` boolean. Tests specifically target the absence of the "X" button in these critical states to prevent users from hiding mandatory subscription alerts.
- **Router Context**: Because the component uses `next/link`, tests will fail unless the `Link` component is mocked or wrapped in a provider, as the test environment lacks the Next.js navigation context.
